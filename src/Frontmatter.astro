---
import { getRegistry, type SchemaMeta } from './integration';

type Props = {
	blocks?: SchemaMeta[];
	callback?: (data: SchemaMeta, i: number) => void;
};

const { blocks, callback } = Astro.props;
const registry = getRegistry();
const components = (await import('virtual:astro-frontmatter-cms')).default;
---

{
	blocks?.map(async (props, i) => {
		if (callback) callback(props, i);
		const block = registry.components[props.type];
		if (!block) return;

		const Component = components[block.type];

		if (Component == null) {
			return <div>Unable to resolve frontmatter component</div>;
		} else {
			return <Component {...props} />;
		}
	})
}
